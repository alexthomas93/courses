= Text2CypherRetriever
:order: 6
:type: lesson
:sandbox: true

== Understanding Text2CypherRetriever

The `Text2CypherRetriever` simplifies the retrieval process by translating natural language queries into Cypher queries using a large language model (LLM). This approach eliminates the need for manual Cypher query writing and complex embedding setups, making data retrieval more intuitive and accessible.

=== What is Text2Cypher?

Text2Cypher converts natural language into Cypher queries. The `Text2CypherRetriever` leverages this by generating precise Cypher queries based on user input, executing them against the Neo4j database, and using the results to inform the language model's responses. This method allows users to interact with the database using plain language, enhancing ease of use and flexibility.

== When to Use Text2CypherRetriever

* **Simplicity**: When you want to avoid manually writing Cypher queries.
* **Natural Interaction**: When users prefer interacting in natural language.
* **Precision**: When specific information needs exact matching, such as dates or names.
* **Accessibility**: When aiming to make data retrieval accessible to developers with varying levels of Neo4j expertise.

== Setting Up Text2CypherRetriever

Follow these steps to set up and use the `Text2CypherRetriever`.

=== Step 1: Install Required Libraries

Install the necessary Python packages:

[source, bash]
----
pip install neo4j-genai neo4j openai
----

=== Step 2: Connect to Your Neo4j Database

Establish a connection using the Neo4j Python driver:

[source, python]
----
from neo4j import GraphDatabase

# Demo database credentials
URI = "neo4j+s://demo.neo4jlabs.com"
AUTH = ("recommendations", "recommendations")

# Connect to Neo4j database
driver = GraphDatabase.driver(URI, auth=AUTH)
----

Placeholder for Image: Neo4j Connection Diagram

=== Step 3: Set Up the Embedding Function

Define a function to generate query embeddings using OpenAI's model:

[source, python]
----
import os
from neo4j_graphrag.embeddings.openai import OpenAIEmbeddings

os.environ["OPENAI_API_KEY"] = "sk-â€¦"
embedder = OpenAIEmbeddings(model="text-embedding-ada-002")
----

=== Step 4: Initialize the Text2CypherRetriever

Create an instance of `Text2CypherRetriever`:

[source, python]
----
from neo4j_graphrag.retrievers import Text2CypherRetriever
from neo4j_graphrag.llm import OpenAILLM

# Create LLM object
t2c_llm = OpenAILLM(model_name="gpt-3.5-turbo")

# (Optional) Specify your own Neo4j schema
neo4j_schema = """
Node properties:
Person {name: STRING, born: INTEGER}
Movie {tagline: STRING, title: STRING, released: INTEGER}
Relationship properties:
ACTED_IN {roles: LIST}
REVIEWED {summary: STRING, rating: INTEGER}
The relationships:
(:Person)-[:ACTED_IN]->(:Movie)
(:Person)-[:DIRECTED]->(:Movie)
(:Person)-[:PRODUCED]->(:Movie)
(:Person)-[:WROTE]->(:Movie)
(:Person)-[:FOLLOWS]->(:Person)
(:Person)-[:REVIEWED]->(:Movie)
"""

# Provide user input/query pairs for the LLM to use as examples
examples = [
    "USER INPUT: 'Which actors starred in the Matrix?' QUERY: MATCH (p:Person)-[:ACTED_IN]->(m:Movie) WHERE m.title = 'The Matrix' RETURN p.name"
]

# Initialize the retriever
retriever = Text2CypherRetriever(
    driver=driver,
    llm=t2c_llm,
    neo4j_schema=neo4j_schema,
    examples=examples,
)
----
* `driver`: Neo4j database driver.
* `llm`: Large language model for query generation.
* `neo4j_schema`: (Optional) Schema definition for better query accuracy.
* `examples`: (Optional) Example queries to guide the LLM.

== Example in Action

Assume you have a recommendations database with movies and actors.

=== Running the Retriever

Use the `Text2CypherRetriever` to find movies starring Hugo Weaving and integrate it into a GraphRAG pipeline:

[source, python]
----
from neo4j_graphrag.generation import GraphRAG

llm = OpenAILLM(model_name="gpt-4o", model_params={"temperature": 0})
rag = GraphRAG(retriever=retriever, llm=llm)

query_text = "Which movies did Hugo Weaving star in?"
response = rag.search(query_text=query_text)
print(response.answer)
----
=== Expected Output

----
Hugo Weaving starred in the following movies:
- The Dressmaker
- V for Vendetta
- The Matrix
- The Adventures of Priscilla, Queen of the Desert
- Proof
----

== Tips for Effective Use

* **Consistent Embeddings**: Use the same model for query and node embeddings.
* **Schema Definition**: Provide a clear Neo4j schema to improve query accuracy.
* **Example Queries**: Supply example queries to guide the LLM in generating accurate Cypher queries.
* **Handle Errors**: Be prepared to handle `Text2CypherRetrievalError` if the generated query is incorrect.

== Next Steps

In the next lesson, you'll learn how to build a GraphRAG pipeline using the `Text2CypherRetriever`.

read::Continue to Building a GraphRAG Pipeline[]

[.summary]
== Summary

You've learned how to use `Text2CypherRetriever` to perform natural language-based data retrieval in Neo4j, simplifying your RAG pipeline by translating user queries into precise Cypher queries. This approach enhances accessibility and efficiency in integrating Neo4j with generative AI models.
